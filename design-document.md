# Webアプリ仕様書

## 1. 概要

LINEなどで文章を送るとき、「表現をやわらかくしたい」「クスッと笑えるスパイスが欲しい」などと思うことがある。
しかし、自分で考えて手直しするのは手間である。
自分の文章を「自動で」力の抜けた文体に直してくれるツールがあると助かる。

このアプリでは、ユーザーが入力したテキストを、LLMを用いておじさん構文風の文体に変換する。
また、おまけ機能として、ユーザーが入力したテキストの喜怒哀楽を判定し、その結果に応じて適切なおじさんの画像を表示する。
これによって、ユーザーの発言をおじさんが代弁しているように感じられるUIにする。

## 2. 主な機能

### 2.1 入出力フォーム機能
- テキストエリアでユーザーが文章を入力する。
- 「おじさん化」ボタンを押すと、2.2 生成AIリクエストAPIを実行し、応答を取得する。
    - 応答待ちの間は、その旨のメッセージと、応答待ち用の画像を表示する。
- 応答をもとに、画面を更新する。
    - 応答が正常であった場合:
        - おじさん構文を表示する。
        - 判定された喜怒哀楽に対応する画像を表示する。
    - 応答がエラーであった場合:
        - エラーメッセージを表示する。
        - エラー用の画像を表示する。

### 2.2 生成AIリクエストAPI
- ユーザー入力と定型プロンプトを合成し、LLMに渡すコンテキストを生成する。具体的には、次の2つである。
    - ユーザーの入力をおじさん構文に変換しなさい
    - ユーザーの入力が喜怒哀楽のいずれに当てはまるか判定しなさい
- OpenRouter経由で、LLM (Gemma 3 27B)へリクエストを送る。
- 応答をJSON形式でフロントエンドに返す。
    - 正常な応答は次の2つからなる。
        - 入力された文章をおじさん構文に変換した文章
        - 入力された文章が喜怒哀楽のいずれに当てはまるかの判定結果
    - 正しい応答が得られなかった場合:
        - おじさん構文への変換で問題が生じた場合、上記2つの正常な応答の代わりにエラーメッセージを返す。
        - 喜怒哀楽の判定で問題が生じた場合、警告を出したうえで、上記2つの正常な応答を返す[^1]。
        このとき、喜怒哀楽についてはいずれでもない値を返す。

[^1]: 喜怒哀楽の判定(と画像の切り替え)は見た目の楽しさを演出するための機能で、失敗しても本アプリの目的である文章変換に影響を及ぼさないため、エラーは返さない

## 3. 使用技術

| 分類         | 技術・ライブラリ |
|--------------|------------------|
| フロントエンド | Vue.js / HTML5 + CSS3 |
| バックエンド  | Flask |
| 通信方式     | Fetch API / JSON |
| LLMモデル    | OpenRouter API (Google Gemma 3 27B) |

## 4. 入出力例

### 入力
- ユーザー入力 : お疲れ様です

- 付与コンテキスト : あなたは文章を変換するツールです。
与えられた文章を、その意味を変えずに、以下のルールに従って「おじさん構文」に変換してください。
変換後の文章だけを出力し、他の余計なテキストは一切含めないでください。
条件は以下の通りです。  
・絵文字を多用する  
・カタカナを多用する  
・読点を多用する  
・語尾が「～だヨ」「～ネ」「～カナ❓」といった親しげな口調になる  
・気遣いや誘いをする  
・140字以内である    
重要: 入力に対するあなたの返答を作成してはいけません。入力された文章そのものを変換してください。

### 出力

- 出力例 : お疲れ様〜٩(ˊᗜˋ*)و  
🎵今日はどんな一日だっタ😘❗❓  
僕は、すごく心配だヨ(._.)😱💦😰そんなときは、オイシイ🍗🤤もの食べて、元気出さなきゃだネ😆